{% extends 'core_base.html' %}
{% block title %}Task{% endblock %}
{% block core-content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% load static %}
<div class="container">
  <div class="py-5 text-center">
    <h2>Task</h2>
    <p class="lead">View or change your task details.</p>
    <div class="container">
      {% for err in form.errors %}
        <div class="alert alert-danger" role="alert">
          {{ err }}
        </div>
      {% endfor %}
    </div>
  </div>
  <div class="row g-5">
    <div class="col-md-7 col-lg-8">
      <div class="row g-3">
        <div class="lead">Task Details</div>
        <div class="col-6">
          <div class="form-floating">
            <input type="text" class="form-control" name="name" maxlength="255" required="" id="id_name" value="{{task.name}}" disabled>
            <label for="id_name">Task Name:</label>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-floating">
            <input type="text" class="form-control" name="type" maxlength="255" required="" id="id_type" disabled value="{{task.type}}" >
            <label for="id_type">Type:</label>
          </div>
        </div>
        <div class="col-sm-12">
          <div class="form-floating">
            <input type="text" class="form-control" name="description" maxlength="255" required="" id="id_description"  disabled value="{{task.description}}" >
            <label for="id_description">Description:</label>
          </div>
        </div>
        <div class="col-sm-12">
          <div class="form-floating">
            <textarea  class="form-control" name="properties" maxlength="255" id="id_properties" value="{{task.properties}}" disabled></textarea>
            <label for="id_properties">Properties:</label>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-5 col-lg-4">
      <div class="row g-3">
        <a href="{% url 'job-task-update' job_id=job.id pk=task.id %}" class="w-100 btn btn-lg btn-secondary" type="submit"><i class="bi bi-pencil"></i> Edit Task</a>
      </div>
      <div class="row g-3 py-3">
        <a href="{% url 'job-tasks' job_id=job.id %}" class="w-100 btn btn-lg btn-outline-dark" type="submit"><i class="bi bi-arrow-left"></i> Back to Job</a>
      </div>
    </div>
    <div class="row g-3 py-1">
      <div class="lead">Target Table</div>
      <div class="col-6">
        <div class="form-floating">
          <input type="text" class="form-control" name="table_type" maxlength="255" required="" id="id_table_type" value="{{task.table_type}}" disabled
          {% if form.table_type.help_text != "" %}  data-bs-container="body" data-bs-toggle="popover" data-bs-placement="right" data-bs-trigger="hover focus" data-bs-animation="true" data-bs-content="{{form.table_type.help_text}}" {% endif %}>
          <label for="id_table_type">Target Table Type:</label>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="form-floating">
          <input type="text" class="form-control" name="write_disposition" maxlength="255" required="" id="id_write_disposition" value="{{task.write_disposition}}" disabled
          {% if form.write_disposition.help_text != "" %}  data-bs-container="body" data-bs-toggle="popover" data-bs-placement="right" data-bs-trigger="hover focus" data-bs-animation="true" data-bs-content="{{form.write_disposition.help_text}}" {% endif %}>
          <label for="id_write_disposition">Write Disposition:</label>
        </div>
      </div>
      <div class="col-6">
        <div class="form-floating">
          <input type="text" class="form-control" name="destination_table" maxlength="255" required="" id="id_destination_table" value="{{task.destination_table}}" disabled
          {% if form.destination_table.help_text != "" %}  data-bs-container="body" data-bs-toggle="popover" data-bs-placement="right" data-bs-trigger="hover focus" data-bs-animation="true" data-bs-content="{{form.destination_table.help_text}}" {% endif %}>
          <label for="id_destination_table">Destination Table:</label>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="form-floating">
          <input type="text" class="form-control" name="destination_dataset" maxlength="255" required="" id="id_destination_dataset" value="{{task.destination_dataset}}" disabled
          {% if form.destination_dataset.help_text != "" %}  data-bs-container="body" data-bs-toggle="popover" data-bs-placement="right" data-bs-trigger="hover focus" data-bs-animation="true" data-bs-content="{{form.destination_dataset.help_text}}" {% endif %}>
          <label for="id_destination_dataset">Destination Dataset:</label>
        </div>
      </div>
      <div class="lead">Source Table</div>
      <div class="col-6">
        <div class="form-floating">
          <input type="text" class="form-control" name="driving_table" maxlength="255" required="" id="id_driving_table" value="{{task.driving_table}}" disabled
          {% if form.driving_table.help_text != "" %}  data-bs-container="body" data-bs-toggle="popover" data-bs-placement="right" data-bs-trigger="hover focus" data-bs-animation="true" data-bs-content="{{form.driving_table.help_text}}" {% endif %}>
          <label for="id_driving_table">Driving Table:</label>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="form-floating">
          <input type="text" class="form-control" name="staging_dataset" maxlength="255" required="" id="id_staging_dataset" value="{{task.staging_dataset}}" disabled 
          {% if form.staging_dataset.help_text != "" %}  data-bs-container="body" data-bs-toggle="popover" data-bs-placement="right" data-bs-trigger="hover focus" data-bs-animation="true" data-bs-content="{{form.staging_dataset.help_text}}" {% endif %}>
          <label for="id_staging_dataset">Staging Dataset:</label>
        </div>
      </div>
    </div> 
    <div class="row g-3 py-1">
      <div class="lead">Source to Target</div>
      <table class="table table-hover table-striped">
        <thead>
          <tr>
            <th scope="col">Target Column</th>
            <th scope="col">Source Column</th>
            <th scope="col">Transformation</th>
            <th scope="col"></th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          {% for field in fields %}
            <tr class="align-middle">
              <td>{% if field.is_primary_key %}<i class="bi bi-key"></i> {% endif %}{% if field.is_history_key %}<i class="bi bi-clock-history"></i> {% endif %}{{ field.name}} </td>
              <td>{% if field.source_name != "" %}{{ field.source_name }}.{% endif %}{{ field.source_column }}</td>
              <td>{{ field.transformation }}</td>
              <td><a href="{% url 'job-task-field' job_id=job.id task_id=task.id pk=field.id %}" class="btn btn-lg btn-secondary"><i class="bi bi-search"></i> View</a></td>
              <td><a href="{% url 'job-task-field-delete' job_id=job.id task_id=task.id pk=field.id %}" class="btn btn-lg btn-danger"><i class="bi bi-trash3"></i> Delete</a></td>
            </tr>
          {% endfor %}
          {% if fields|length == 0 %}
            <tr><td class="text-center" colspan="5">No fields linked to task!</td></tr>
          {% endif %}
        </tbody>
      </table>
      <div class="col-md-5 col-lg-4">
        <a href="{% url 'job-task-field-add' job_id=job.id task_id=task.id %}" class="btn btn-primary btn-lg" type="button"><i class="bi bi-plus"></i> Add Column</a> 
      </div>
    </div>
    <div class="row g-3 py-1">
      <div class="lead">Joins</div>
      {% if joins|length == 0 %}
      <div class="row g-3 py-1">

      </div>
      {% endif %}
      <div class="col-md-5 col-lg-4">
        <a href="{% url 'job-task-field-add' job_id=job.id task_id=task.id %}" class="btn btn-primary btn-lg" type="button"><i class="bi bi-plus"></i> Add Join</a> 
      </div>
    </div>
  </div>  
</div>
{% endblock %}

