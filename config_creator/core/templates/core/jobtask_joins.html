<div class="accordion-item">
  <div class="accordion-header" id="heading-joins">
    <button class="lead accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-joins" aria-expanded="false" aria-controls="collapse-joins">
      Joins
    </button>
  </div>
  <div class="accordion-collapse collapse" id="collapse-joins" aria-labelledby="heading-joins">
    <div class="row g-3 py-3">
      {% if joins|length > 0 %}
      <div class="row g-3 py-1" id="id_join_container_parent">
        {% for join in joins %}
        <div class="container py-3 px-3 bg-light rounded" id="id_join_container_{{ join.join.id }}">
          <div class="row g-3 py-1">
            <div class="col-md-12 col-lg-12">
              <h5>{{ join.join.type}} {{  join.join.left_table }} to {{ join.join.right_table }}</h5>
            </div>
          </div>
          <div class="row g-3 py-1">
            <div class="col-lg-1 col-md-1">
              <p class="lead">on</p>
            </div>
            <div class="col-lg-11 col-md-11">
              <table class="table table-hover">
                <thead>
                  <th scope="col"></th>
                  <th scope="col"></th>
                  <th scope="col"></th>
                  <th scope="col"></th>
                  <th scope="col"></th>
                  <th scope="col"></th>
                </thead>
                <tbody class="text-center align-middle">
                  {% for condition in join.conditions %}
                      <tr id="id_join_condition_{{ condition.condition.id }}_row">
                        <td>{{ condition.condition.logic_operator }}</td>
                        <td>{{ condition.condition.left }}</td>
                        <td>{{ condition.condition.operator }}</td>
                        <td>{{ condition.condition.right }}</td>
                        <td class="btn-column"><a class="btn btn-secondary" href="{% url 'job-task-join-condition-update' job_id=job.id task_id=task.id join_id=join.join.id pk=condition.condition.id %}" title="Edit" aria-current="page" data-bs-toggle="tooltip" data-bs-placement="right"><i class="bi bi-pencil"></i></a></td>
                        <td class="btn-column"><button class="btn btn-danger join-delete" id="id_join_condition_delete_{{ condition.condition.id }}"
                          type="button" title="Delete" aria-current="page" data-bs-toggle="tooltip" data-bs-placement="right"
                          data-delete-url="{% url 'api-condition-delete' pk=condition.condition.id %}"
                          data-delete-element-id="id_join_condition_{{ condition.condition.id }}_row"><i class="bi bi-trash3"></i></button></td>
                      </tr>
                  {% endfor %}
                  {% if join.conditions|length == 0 %}
                    <tr><td class="text-center" colspan="6">No conditions linked to join!</td></tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
            <div class="row g-3 py-1">
              <div class="col-md-2 col-lg-2">
                <a class="w-100 btn btn-info" type="button" href="{% url 'job-task-join-condition-add' job_id=job.id task_id=task.id join_id=join.join.id %}" title=""><i class="bi bi-plus"></i> Add Condition</a> 
              </div>
              <div class="col-md-2 col-lg-2">
                <button class="w-100 btn btn-danger join-delete" id="id_delete_join_{{ join.join.id }}" type="button" data-job-id="{{ job.id }}" data-task-id="{{ task.id }}" data-join-id="{{ join.join.id }}"><i class="bi bi-trash3"></i> Delete Join</button> 
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}
      <div class="col-md-4 col-lg-3">
        <button class="btn btn-primary" id="id_add_join" type="button" data-job-id="{{ job.id }}" data-task-id="{{ task.id }}"><i class="bi bi-plus"></i> Add Join</button> 
      </div>
    </div>
  </div>
</div>
<script>
  let joinListenerMap = new Map()
  const joinDeleteButtonList = document.getElementsByClassName("join-delete");
  for (var i = 0; i < joinDeleteButtonList.length; i++) {
    joinListenerMap.set(joinDeleteButtonList[i].id, {
      'function': 'deleteJoin(this.dataset["jobId"], this.dataset["taskId"], this.dataset["joinId"])',
      "type": "click"
    })
  }

  joinListenerMap.set("id_add_join", {
    'function': 'prepareJoinModal(this.dataset["jobId"], this.dataset["taskId"], null)',
    'type': 'click'
  })
  
  joinListenerMap.forEach(addListener);
  </script>