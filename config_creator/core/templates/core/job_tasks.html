{% extends 'core_base.html' %}
{% block title %}Job Tasks{% endblock %}
{% block core-content %}
{% load static %}
<div class="container">
  <div class="py-5 text-center">
    <h2>Job</h2>
    <p class="lead">View or change your job and it's tasks.</p>
  </div>
  <div class="row g-5">
    <div class="col-md-7 col-lg-8">
      <div class="row g-3">
        <p class="lead">Job Details</p>
        <div class="col-6">
          <div class="form-floating">
            <input type="text" class="form-control" name="name" maxlength="255" required="" id="id_name" disabled value="{{job.name}}" >
            <label for="id_name">Job Name:</label>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-floating">
            <input type="text" class="form-control" name="type" maxlength="255" required="" id="id_type" disabled value="{{job.type}}" >
            <label for="id_type">Type:</label>
          </div>
        </div>
        <div class="col-sm-12">
          <div class="form-floating">
            <input type="text" class="form-control" name="description" maxlength="255" required="" id="id_description"  disabled value="{{job.description}}" >
            <label for="id_description">Description:</label>
          </div>
        </div>
        <div class="col-sm-12">
          <div class="form-floating">
            <textarea  class="form-control" name="properties" id="id_properties" disabled>{{ job.properties|pprint }}</textarea>
            <label for="id_properties">Properties:</label>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-5 col-lg-4">
      <div class="row g-3">
        <a href="{% url 'job-update' pk=job.id %}" class="w-100 btn  btn-secondary" type="submit"><i class="bi bi-pencil"></i> Edit Job</a>
      </div>
      <div class="row g-3 py-3">
        <a href="{% url 'jobs' %}" class="w-100 btn  btn-outline-dark" type="submit"><i class="bi bi-arrow-left"></i> Back to Jobs</a>
      </div>
      <div class="row g-3">
        <a href="{% url 'job-download' pk=job.id %}" class="btn btn-info"><i class="bi bi-box-arrow-down"></i> Download Config</a>
      </div>
    </div>

    <div class="row g-3 py-5">
      <div class="lead">Tasks</div>
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Type</th>
            <th scope="col">Description</th>
            <th scope="col">Last Update</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for task in tasks %}
            <tr>
              <td>{{ task.name }}</td>
              <td>{{ task.type }}</td>
              <td>{{ task.description }}</td>
              <td>{{ task.lastupdate }}</td>
              <td class="btn-column"><a href="{% url 'job-task' job_id=job.id pk=task.id %}" class="btn  btn-secondary" aria-current="page" title="View" data-bs-toggle="tooltip" data-bs-placement="right"><i class="bi bi-search"></i></a></td>
              <td class="btn-column"><a href="{% url 'job-task-delete' job_id=job.id pk=task.id %}" class="btn  btn-danger" aria-current="page" title="Delete" data-bs-toggle="tooltip" data-bs-placement="right"><i class="bi bi-trash3"></i></a></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="col-md-5 col-lg-4">
        <a href="{% url 'job-task-add' job_id=job.id %}" class="btn btn-primary " type="button"><i class="bi bi-plus"></i> Add Task</a> 
      </div>
    </div> 
    
  </div>  
  <script>
    document.getElementById("{{job.type.id_for_label}}").classList.add("form-select");
  </script>
<script>
  let ta = document.getElementById("id_properties");
  let numberOfLineBreaks = (ta.value.match(/\n/g) || []).length;
  let newHeight = 50 + numberOfLineBreaks * 20 + 12 + 2;
  ta.style.height = newHeight + "px";
</script>
</div>
{% endblock %}
